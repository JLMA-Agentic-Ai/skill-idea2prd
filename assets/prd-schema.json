{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "PRD Generation Schema",
  "description": "Schema for validating PRD generation inputs and outputs",
  "type": "object",
  "properties": {
    "input": {
      "type": "object",
      "properties": {
        "userIdea": {
          "type": "string",
          "minLength": 10,
          "maxLength": 10240,
          "pattern": "^[a-zA-Z0-9\\s\\-_.,!?()\\[\\]{}\\n\\r]*$",
          "description": "User's idea or problem description"
        },
        "requirements": {
          "type": "string",
          "maxLength": 5120,
          "pattern": "^[a-zA-Z0-9\\s\\-_.,!?()\\[\\]{}\\n\\r]*$",
          "description": "Additional requirements and constraints"
        },
        "stakeholders": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^[a-zA-Z0-9\\s\\-_.,]*$"
          },
          "maxItems": 10,
          "description": "List of stakeholders"
        },
        "constraints": {
          "type": "object",
          "properties": {
            "timeline": {
              "type": "string",
              "pattern": "^[0-9]+ (weeks?|months?)$"
            },
            "budget": {
              "type": "string",
              "pattern": "^\\$?[0-9,]+(\\.[0-9]{2})?$"
            },
            "team_size": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100
            }
          },
          "additionalProperties": false
        }
      },
      "required": ["userIdea"],
      "additionalProperties": false
    },
    "output": {
      "type": "object",
      "properties": {
        "metadata": {
          "type": "object",
          "properties": {
            "version": {
              "type": "string",
              "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$"
            },
            "generated": {
              "type": "string",
              "format": "date-time"
            },
            "securityLevel": {
              "type": "string",
              "enum": ["Low", "Medium", "High", "Critical"]
            },
            "validated": {
              "type": "boolean"
            }
          },
          "required": ["version", "generated", "securityLevel", "validated"],
          "additionalProperties": false
        },
        "sections": {
          "type": "object",
          "properties": {
            "executiveSummary": {
              "type": "string",
              "minLength": 50,
              "maxLength": 2000
            },
            "problemStatement": {
              "type": "string",
              "minLength": 50,
              "maxLength": 3000
            },
            "functionalRequirements": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "id": {
                    "type": "string",
                    "pattern": "^FR[0-9]{3}$"
                  },
                  "title": {
                    "type": "string",
                    "maxLength": 100
                  },
                  "description": {
                    "type": "string",
                    "maxLength": 1000
                  },
                  "priority": {
                    "type": "string",
                    "enum": ["Critical", "High", "Medium", "Low"]
                  }
                },
                "required": ["id", "title", "description", "priority"]
              },
              "minItems": 1,
              "maxItems": 50
            },
            "nonFunctionalRequirements": {
              "type": "object",
              "properties": {
                "performance": {
                  "type": "array",
                  "items": {
                    "type": "string",
                    "maxLength": 500
                  }
                },
                "security": {
                  "type": "array",
                  "items": {
                    "type": "string",
                    "maxLength": 500
                  }
                },
                "scalability": {
                  "type": "array",
                  "items": {
                    "type": "string",
                    "maxLength": 500
                  }
                },
                "reliability": {
                  "type": "array",
                  "items": {
                    "type": "string",
                    "maxLength": 500
                  }
                }
              },
              "additionalProperties": false
            },
            "technicalArchitecture": {
              "type": "object",
              "properties": {
                "pattern": {
                  "type": "string",
                  "enum": ["Layered", "Microservices", "Hexagonal", "Event-Driven", "Serverless"]
                },
                "technologyStack": {
                  "type": "object",
                  "properties": {
                    "frontend": {
                      "type": "string",
                      "maxLength": 200
                    },
                    "backend": {
                      "type": "string",
                      "maxLength": 200
                    },
                    "database": {
                      "type": "string",
                      "maxLength": 200
                    },
                    "infrastructure": {
                      "type": "string",
                      "maxLength": 200
                    }
                  },
                  "additionalProperties": false
                },
                "securityArchitecture": {
                  "type": "object",
                  "properties": {
                    "authentication": {
                      "type": "string",
                      "maxLength": 500
                    },
                    "authorization": {
                      "type": "string",
                      "maxLength": 500
                    },
                    "dataProtection": {
                      "type": "string",
                      "maxLength": 500
                    }
                  },
                  "additionalProperties": false
                }
              },
              "required": ["pattern", "technologyStack", "securityArchitecture"],
              "additionalProperties": false
            }
          },
          "required": ["executiveSummary", "problemStatement", "functionalRequirements", "nonFunctionalRequirements", "technicalArchitecture"],
          "additionalProperties": false
        },
        "securityValidation": {
          "type": "object",
          "properties": {
            "scanCompleted": {
              "type": "boolean"
            },
            "vulnerabilitiesFound": {
              "type": "integer",
              "minimum": 0
            },
            "riskLevel": {
              "type": "string",
              "enum": ["Low", "Medium", "High", "Critical"]
            },
            "lastScanDate": {
              "type": "string",
              "format": "date-time"
            }
          },
          "required": ["scanCompleted", "vulnerabilitiesFound", "riskLevel", "lastScanDate"],
          "additionalProperties": false
        }
      },
      "required": ["metadata", "sections", "securityValidation"],
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}